<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="agri-build" content="cb85b79" />
  <title>농산물 뉴스 브리핑</title>
  <style>
    :root {
      --bg:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --btn:#1d4ed8;
      --btnHover:#1e40af;
      --chip:#f3f4f6;
      --mark:#fef08a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial;}
    .wrap{max-width:1040px;margin:0 auto;padding:26px 16px 70px}
    h1{margin:0;font-size:22px;letter-spacing:-0.2px}
    .sub{color:var(--muted);margin-top:8px;font-size:13px;line-height:1.5}
    .btn{display:inline-flex;align-items:center;justify-content:center;margin-top:14px;text-decoration:none;color:#fff;
         border:1px solid var(--btn);padding:10px 14px;border-radius:12px;background:var(--btn);font-weight:900; cursor:pointer; user-select:none}
    .btn:hover{background:var(--btnHover);border-color:var(--btnHover)}
    .btn.disabled{opacity:.5; cursor:pointer}
    .btn.ghost{background:#fff;color:var(--btn);border-color:var(--line)}
    .btn.ghost:hover{border-color:#cbd5e1;background:#f8fafc}

    .panel{margin-top:18px;border:1px solid var(--line);border-radius:16px;background:#fff;padding:14px}
    .panelTitle{font-weight:900;margin-bottom:10px;display:flex;gap:10px;align-items:center;justify-content:space-between}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media (max-width: 820px) { .grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width: 520px) { .grid{grid-template-columns:1fr;} }

    .card{display:block;text-decoration:none;border:1px solid var(--line);border-radius:14px;padding:12px;
          background:#ffffff;color:var(--text)}
    .card:hover{border-color:#cbd5e1}
    .dt{font-size:15px;font-weight:900}
    .meta{margin-top:6px;color:var(--muted);font-size:12px}
    .empty{color:var(--muted);font-size:13px}

    /* search */
    .searchRow{display:flex;gap:10px;align-items:center}
    .searchInput{flex:1;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-size:14px}
    .searchInput:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 3px rgba(59,130,246,.12)}

    .filters{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .sel,.date{border:1px solid var(--line);border-radius:12px;padding:8px 10px;font-size:13px;background:#fff}
    .sel:focus,.date:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 3px rgba(59,130,246,.12)}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid var(--line);
          padding:3px 8px;border-radius:999px;font-size:11px;color:#374151}
    .chip b{font-weight:900}
    .hint{margin-top:8px;color:var(--muted);font-size:12px;line-height:1.4}
    .metaLine{margin-top:10px;color:var(--muted);font-size:12px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
    .metaLeft{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

    mark{background:var(--mark);padding:0 2px;border-radius:4px}

    .results{margin-top:10px;display:flex;flex-direction:column;gap:10px}
    .result{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
    .rTop{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
    .rTitle{margin-top:6px;font-weight:900;font-size:14px;line-height:1.35}
    .rSum{margin-top:6px;color:#374151;font-size:13px;line-height:1.45}
    .rLinks{margin-top:9px;display:flex;gap:12px;font-size:12px}
    .rLinks a{color:var(--btn);text-decoration:none;font-weight:900}
    .rLinks a:hover{text-decoration:underline}

    .pager{margin-top:10px;display:flex;gap:8px;align-items:center;justify-content:flex-end;flex-wrap:wrap}
    .pager .pbtn{padding:8px 10px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:900;color:#111827}
    .pager .pbtn:hover{border-color:#cbd5e1;background:#f8fafc}
    .pager .pbtn[disabled]{opacity:.5;cursor:not-allowed}
    .pager .pinfo{color:var(--muted);font-size:12px;margin-right:auto}

    .groupHdr{margin-top:8px;font-weight:900;font-size:13px;color:#111827}
    .groupWrap{display:flex;flex-direction:column;gap:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>농산물 뉴스 브리핑</h1>
    <div class="sub">최신 브리핑과 날짜별 아카이브를 제공합니다. (키워드 검색 · 기간/섹션 필터 · 정렬 지원)</div>

    <a class="btn" href="/agri-news-brief/archive/2026-02-21.html">최신 브리핑 열기</a>

    <div class="panel">
      <div class="panelTitle">
        <span>키워드 검색</span>
        <span style="color:var(--muted);font-size:12px;font-weight:700">* 2글자 이상부터 결과 표시</span>
      </div>

      <div class="searchRow">
        <input id="q" class="searchInput" type="search" placeholder="예: 사과 가격, 샤인머스캣 수급, 병해충 방제" />
        <button id="clearBtn" class="btn" style="margin-top:0;padding:10px 12px;" type="button">초기화</button>
      </div>

      <div class="filters">
        <select id="secSel" class="sel" title="섹션">
          <option value="">전체 섹션</option>
        </select>

        <select id="sortSel" class="sel" title="정렬">
          <option value="relevance">관련도순</option>
          <option value="date">최신순</option>
          <option value="press">매체 중요도순</option>
          <option value="score">선정 점수순</option>
        </select>

        <span class="chip"><b>기간</b></span>
        <input id="fromDate" class="date" type="date" />
        <span style="color:var(--muted);font-size:12px;">~</span>
        <input id="toDate" class="date" type="date" />

        <button id="quick7" class="btn ghost" style="margin-top:0;padding:8px 10px;" type="button">7일</button>
        <button id="quick30" class="btn ghost" style="margin-top:0;padding:8px 10px;" type="button">30일</button>
        <button id="quick90" class="btn ghost" style="margin-top:0;padding:8px 10px;" type="button">90일</button>
        <button id="quickAll" class="btn ghost" style="margin-top:0;padding:8px 10px;" type="button">전체</button>

        <label class="chip" style="cursor:pointer">
          <input id="groupToggle" type="checkbox" style="margin:0" />
          날짜별 그룹
        </label>
      </div>

      <div class="hint">검색 대상: 제목/요약/언론사/섹션/날짜.  (예: "사과 가격" 처럼 띄어쓰기를 하면 모든 단어가 포함된 기사만 표시됩니다.)</div>

      <div class="metaLine">
        <div id="metaLeft" class="metaLeft"></div>
        <div id="metaRight" style="color:var(--muted)"></div>
      </div>

      <div id="results" class="results"></div>
      <div id="pager" class="pager" style="display:none"></div>
    </div>

    <div class="panel">
      <div class="panelTitle">날짜별 아카이브</div>
      <div class="grid">
        
          <a class="card" href="/agri-news-brief/archive/2026-02-21.html">
            <div class="dt">2026년 2월 21일</div>
            <div class="meta">2026-02-21 · 토요일</div>
          </a>
        

          <a class="card" href="/agri-news-brief/archive/2026-02-20.html">
            <div class="dt">2026년 2월 20일</div>
            <div class="meta">2026-02-20 · 금요일</div>
          </a>
        

          <a class="card" href="/agri-news-brief/archive/2026-02-19.html">
            <div class="dt">2026년 2월 19일</div>
            <div class="meta">2026-02-19 · 목요일</div>
          </a>
        

          <a class="card" href="/agri-news-brief/archive/2026-02-18.html">
            <div class="dt">2026년 2월 18일</div>
            <div class="meta">2026-02-18 · 수요일</div>
          </a>
        
      </div>
    </div>
  </div>

  <script>
    (function() {
      // disabled latest button -> alert
      var b = document.querySelector("button.btn.disabled[data-msg]");
      if (b) {
        b.addEventListener("click", function() {
          alert(b.getAttribute("data-msg") || "이동할 페이지가 없습니다.");
        });
      }

      var input = document.getElementById("q");
      var clearBtn = document.getElementById("clearBtn");
      var secSel = document.getElementById("secSel");
      var sortSel = document.getElementById("sortSel");
      var fromDate = document.getElementById("fromDate");
      var toDate = document.getElementById("toDate");
      var quick7 = document.getElementById("quick7");
      var quick30 = document.getElementById("quick30");
      var quick90 = document.getElementById("quick90");
      var quickAll = document.getElementById("quickAll");
      var groupToggle = document.getElementById("groupToggle");

      var metaLeft = document.getElementById("metaLeft");
      var metaRight = document.getElementById("metaRight");
      var box = document.getElementById("results");
      var pager = document.getElementById("pager");

      var DATA = null;
      var LOADING = false;

      var PAGE_SIZE = 20;
      var PAGE = 1;

      function escHtml(s) {
        return (s || "").replace(/[&<>"']/g, function(c) {
          return ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"})[c] || c;
        });
      }
      function norm(s) { return (s || "").toLowerCase(); }

      function escapeRegExp(s) {
        return (s || "").replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      }

      function highlight(text, tokens) {
        var out = escHtml(text || "");
        for (var i=0; i<tokens.length; i++) {
          var t = tokens[i];
          if (!t || t.length < 2) continue;
          try {
            var re = new RegExp(escapeRegExp(t), "gi");
            out = out.replace(re, function(m) { return "<mark>" + m + "</mark>"; });
          } catch(e) {}
        }
        return out;
      }

      function debounce(fn, ms) {
        var t = null;
        return function() {
          var args = arguments;
          clearTimeout(t);
          t = setTimeout(function() { fn.apply(null, args); }, ms);
        }
      }

      function ymdToInt(s) {
        if (!s) return 0;
        return parseInt(String(s).replaceAll("-", ""), 10) || 0;
      }

      function setQuickRange(days) {
        if (!DATA) return;
        var maxD = DATA.max_date || "";
        if (!maxD) return;
        var maxI = ymdToInt(maxD);
        var yyyy = parseInt(maxD.slice(0,4),10);
        var mm = parseInt(maxD.slice(5,7),10);
        var dd = parseInt(maxD.slice(8,10),10);
        var dt = new Date(Date.UTC(yyyy, mm-1, dd));
        if (days === null) {
          fromDate.value = DATA.min_date || "";
          toDate.value = DATA.max_date || "";
          return;
        }
        var from = new Date(dt.getTime() - (days-1) * 24*3600*1000);
        var fy = from.getUTCFullYear();
        var fm = String(from.getUTCMonth()+1).padStart(2,"0");
        var fd = String(from.getUTCDate()).padStart(2,"0");
        fromDate.value = fy + "-" + fm + "-" + fd;
        toDate.value = DATA.max_date || "";
      }

      function setMeta(tokens, resCount, showCount) {
        metaLeft.innerHTML = "";
        var q = (input.value || "").trim();
        if (!q || q.length < 2) {
          metaRight.textContent = "";
          return;
        }
        // chips
        metaLeft.innerHTML += "<span class='chip'><b>검색</b> " + escHtml(q) + "</span>";
        var secV = secSel.value || "";
        if (secV) metaLeft.innerHTML += "<span class='chip'><b>섹션</b> " + escHtml(secSel.options[secSel.selectedIndex].text) + "</span>";
        var fr = fromDate.value || "";
        var to = toDate.value || "";
        if (fr || to) metaLeft.innerHTML += "<span class='chip'><b>기간</b> " + escHtml(fr||"…") + " ~ " + escHtml(to||"…") + "</span>";
        metaLeft.innerHTML += "<span class='chip'><b>정렬</b> " + escHtml(sortSel.options[sortSel.selectedIndex].text) + "</span>";

        metaRight.textContent = "총 " + resCount + "건 · " + showCount + "건 표시";
      }

      function computeRelevance(it, tokens) {
        var t = norm(it.title || "");
        var s = norm(it.summary || "");
        var p = norm(it.press || "");
        var sec = norm(it.section_title || it.section || "");
        var base = 0;

        // token match (AND)
        var match = 0;
        for (var i=0; i<tokens.length; i++) {
          var tok = tokens[i];
          if (!tok) continue;
          var inTitle = t.indexOf(tok) !== -1;
          var inSum = s.indexOf(tok) !== -1;
          var inMeta = p.indexOf(tok) !== -1 || sec.indexOf(tok) !== -1;
          if (inTitle || inSum || inMeta) match += 1;
          if (inTitle) base += 70;
          else if (inSum) base += 40;
          else if (inMeta) base += 15;
        }

        // press tier / score
        var pt = parseInt(it.press_tier || 0, 10) || 0;
        var sc = parseFloat(it.score || 0) || 0;
        base += pt * 18;
        base += Math.min(30, sc); // score cap
        base += match * 10;
        return base;
      }

      function filterItems(tokens) {
        var items = (DATA && DATA.items) ? DATA.items : [];
        var res = [];

        var q = (input.value || "").trim();
        if (!q || q.length < 2) return res;

        // AND search
        for (var i=0; i<items.length; i++) {
          var it = items[i] || {};
          var hay = norm((it.title||"") + " " + (it.summary||"") + " " + (it.press||"") + " " + (it.section_title||"") + " " + (it.date||""));
          var ok = true;
          for (var j=0; j<tokens.length; j++) {
            if (hay.indexOf(tokens[j]) === -1) { ok = false; break; }
          }
          if (!ok) continue;

          // section
          var secV = secSel.value || "";
          if (secV && String(it.section||"") !== secV) continue;

          // date range
          var di = ymdToInt(it.date || "");
          var fr = ymdToInt(fromDate.value || "");
          var to = ymdToInt(toDate.value || "");
          if (fr && di < fr) continue;
          if (to && di > to) continue;

          // precompute relevance
          it._rel = computeRelevance(it, tokens);
          res.push(it);
        }
        return res;
      }

      function sortItems(list) {
        var mode = sortSel.value || "relevance";
        list.sort(function(a,b) {
          var da = ymdToInt(a.date||"");
          var db = ymdToInt(b.date||"");
          var pa = parseInt(a.press_tier||0,10)||0;
          var pb = parseInt(b.press_tier||0,10)||0;
          var sa = parseFloat(a.score||0)||0;
          var sb = parseFloat(b.score||0)||0;
          var ra = parseFloat(a._rel||0)||0;
          var rb = parseFloat(b._rel||0)||0;

          if (mode === "date") {
            if (db !== da) return db - da;
            if (pb !== pa) return pb - pa;
            return sb - sa;
          }
          if (mode === "press") {
            if (pb !== pa) return pb - pa;
            if (db !== da) return db - da;
            return rb - ra;
          }
          if (mode === "score") {
            if (sb !== sa) return sb - sa;
            if (pb !== pa) return pb - pa;
            return db - da;
          }
          // relevance
          if (rb !== ra) return rb - ra;
          if (pb !== pa) return pb - pa;
          return db - da;
        });
      }

      function renderPager(total) {
        var totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
        if (total <= PAGE_SIZE) {
          pager.style.display = "none";
          pager.innerHTML = "";
          return;
        }
        pager.style.display = "flex";
        var prevDis = (PAGE <= 1) ? "disabled" : "";
        var nextDis = (PAGE >= totalPages) ? "disabled" : "";

        pager.innerHTML = ""
          + "<div class='pinfo'>페이지 " + PAGE + " / " + totalPages + "</div>"
          + "<button class='pbtn' id='prevBtn' " + prevDis + ">이전</button>"
          + "<button class='pbtn' id='nextBtn' " + nextDis + ">다음</button>";

        var prevBtn = document.getElementById("prevBtn");
        var nextBtn = document.getElementById("nextBtn");
        if (prevBtn) prevBtn.addEventListener("click", function(){ if (PAGE>1) { PAGE--; runSearch(); } });
        if (nextBtn) nextBtn.addEventListener("click", function(){ if (PAGE<totalPages) { PAGE++; runSearch(); } });
      }

      function renderList(res, tokens) {
        var start = (PAGE - 1) * PAGE_SIZE;
        var slice = res.slice(start, start + PAGE_SIZE);

        if (slice.length === 0) {
          box.innerHTML = "<div class='empty'>검색 결과가 없습니다.</div>";
          renderPager(0);
          setMeta(tokens, res.length, 0);
          return;
        }

        var html = "";
        for (var k=0; k<slice.length; k++) {
          var r = slice[k];
          var date = escHtml(r.date || "");
          var sec = escHtml(r.section_title || r.section || "");
          var press = escHtml(r.press || "");
          var title = highlight(r.title || "", tokens);
          var sum = highlight(r.summary || "", tokens);

          var aHref = r.archive || "";
          var uHref = r.url || "";

          var tier = parseInt(r.press_tier||0,10)||0;
          var tierLabel = tier>=4 ? "공식" : (tier>=3 ? "주요" : (tier>=2 ? "지역/전문" : "기타"));
          html += "<div class='result'>"
               +  "<div class='rTop'>"
               +    "<span class='chip'>" + date + "</span>"
               +    "<span class='chip'>" + sec + "</span>"
               +    (press ? "<span class='chip'>" + press + "</span>" : "")
               +    "<span class='chip'><b>" + tierLabel + "</b></span>"
               +  "</div>"
               +  "<div class='rTitle'>" + title + "</div>"
               +  (sum ? "<div class='rSum'>" + sum + "</div>" : "")
               +  "<div class='rLinks'>"
               +    (aHref ? "<a href='" + aHref + "'>브리핑 보기</a>" : "")
               +    (uHref ? "<a href='" + uHref + "' target='_blank' rel='noopener'>원문 열기</a>" : "")
               +  "</div>"
               + "</div>";
        }
        box.innerHTML = html;
        renderPager(res.length);
        setMeta(tokens, res.length, slice.length);
      }

      function renderGrouped(res, tokens) {
        var start = (PAGE - 1) * PAGE_SIZE;
        var slice = res.slice(start, start + PAGE_SIZE);
        if (slice.length === 0) {
          box.innerHTML = "<div class='empty'>검색 결과가 없습니다.</div>";
          renderPager(0);
          setMeta(tokens, res.length, 0);
          return;
        }
        var groups = {};
        for (var i=0;i<slice.length;i++) {
          var d = slice[i].date || "";
          if (!groups[d]) groups[d] = [];
          groups[d].push(slice[i]);
        }
        var dates = Object.keys(groups).sort(function(a,b){return ymdToInt(b)-ymdToInt(a);});
        var html = "<div class='groupWrap'>";
        for (var gi=0; gi<dates.length; gi++) {
          var d = dates[gi];
          html += "<div class='groupHdr'>" + escHtml(d) + "</div>";
          var arr = groups[d] || [];
          for (var k=0; k<arr.length; k++) {
            var r = arr[k];
            var sec = escHtml(r.section_title || r.section || "");
            var press = escHtml(r.press || "");
            var title = highlight(r.title || "", tokens);
            var sum = highlight(r.summary || "", tokens);
            var aHref = r.archive || "";
            var uHref = r.url || "";
            var tier = parseInt(r.press_tier||0,10)||0;
            var tierLabel = tier>=4 ? "공식" : (tier>=3 ? "주요" : (tier>=2 ? "지역/전문" : "기타"));

            html += "<div class='result'>"
                 +  "<div class='rTop'>"
                 +    "<span class='chip'>" + sec + "</span>"
                 +    (press ? "<span class='chip'>" + press + "</span>" : "")
                 +    "<span class='chip'><b>" + tierLabel + "</b></span>"
                 +  "</div>"
                 +  "<div class='rTitle'>" + title + "</div>"
                 +  (sum ? "<div class='rSum'>" + sum + "</div>" : "")
                 +  "<div class='rLinks'>"
                 +    (aHref ? "<a href='" + aHref + "'>브리핑 보기</a>" : "")
                 +    (uHref ? "<a href='" + uHref + "' target='_blank' rel='noopener'>원문 열기</a>" : "")
                 +  "</div>"
                 + "</div>";
          }
        }
        html += "</div>";
        box.innerHTML = html;
        renderPager(res.length);
        setMeta(tokens, res.length, slice.length);
      }

      function runSearch() {
        var q = (input.value || "").trim();
        if (!q || q.length < 2) {
          box.innerHTML = "";
          metaLeft.innerHTML = "";
          metaRight.textContent = "";
          pager.style.display = "none";
          return;
        }
        if (!DATA) {
          metaLeft.innerHTML = "<span class='chip'><b>안내</b> 검색 인덱스를 불러오는 중입니다...</span>";
          return;
        }

        var tokens = q.split(/\s+/).map(function(x){return norm(x);}).filter(Boolean);
        var res = filterItems(tokens);
        sortItems(res);

        if (PAGE < 1) PAGE = 1;
        var totalPages = Math.max(1, Math.ceil(res.length / PAGE_SIZE));
        if (PAGE > totalPages) PAGE = totalPages;

        if (groupToggle && groupToggle.checked) renderGrouped(res, tokens);
        else renderList(res, tokens);
      }

      function resetAll() {
        if (input) input.value = "";
        if (secSel) secSel.value = "";
        if (sortSel) sortSel.value = "relevance";
        if (groupToggle) groupToggle.checked = false;
        if (DATA) {
          fromDate.value = DATA.min_date || "";
          toDate.value = DATA.max_date || "";
        } else {
          fromDate.value = "";
          toDate.value = "";
        }
        PAGE = 1;
        box.innerHTML = "";
        metaLeft.innerHTML = "";
        metaRight.textContent = "";
        pager.style.display = "none";
        if (input) input.focus();
      }

      async function ensureData() {
        if (DATA || LOADING) return;
        LOADING = true;
        metaLeft.innerHTML = "<span class='chip'><b>안내</b> 검색 인덱스를 불러오는 중...</span>";
        try {
          var url = "/agri-news-brief/search_index.json" + "?t=" + Date.now(); // cache bust
          var r = await fetch(url, {cache: "no-store"});
          if (!r.ok) throw new Error("HTTP " + r.status);
          DATA = await r.json();

          // compute min/max date
          var items = DATA.items || [];
          var minD = "", maxD = "";
          for (var i=0;i<items.length;i++) {
            var d = items[i].date || "";
            if (!d) continue;
            if (!minD || ymdToInt(d) < ymdToInt(minD)) minD = d;
            if (!maxD || ymdToInt(d) > ymdToInt(maxD)) maxD = d;
          }
          DATA.min_date = minD;
          DATA.max_date = maxD;

          // build section options
          var map = {};
          for (var i=0;i<items.length;i++) {
            var it = items[i]||{};
            if (!it.section) continue;
            if (!map[it.section]) map[it.section] = it.section_title || it.section;
          }
          var keys = Object.keys(map).sort();
          for (var i=0;i<keys.length;i++) {
            var k = keys[i];
            var opt = document.createElement("option");
            opt.value = k;
            opt.textContent = map[k];
            secSel.appendChild(opt);
          }

          // default date: last 30 days
          if (minD && maxD) {
            fromDate.value = minD;
            toDate.value = maxD;
            setQuickRange(30);
          }

          metaLeft.innerHTML = "<span class='chip'><b>준비 완료</b> 키워드를 입력하세요</span>";
          metaRight.textContent = "인덱스 " + items.length + "건";
        } catch(e) {
          DATA = null;
          metaLeft.innerHTML = "<span class='chip'><b>오류</b> 검색 인덱스를 불러오지 못했습니다. 새로고침 후 다시 시도하세요.</span>";
          metaRight.textContent = "";
        } finally {
          LOADING = false;
        }
      }

      // events
      if (input) {
        input.addEventListener("focus", function() { ensureData(); });
        input.addEventListener("input", debounce(function() {
          ensureData();
          PAGE = 1;
          runSearch();
        }, 160));
        input.addEventListener("keydown", function(ev) {
          if (ev.key === "Enter") {
            ensureData();
            PAGE = 1;
            runSearch();
          }
        });
      }
      if (clearBtn) clearBtn.addEventListener("click", function() { resetAll(); });
      if (secSel) secSel.addEventListener("change", function() { PAGE = 1; runSearch(); });
      if (sortSel) sortSel.addEventListener("change", function() { PAGE = 1; runSearch(); });
      if (fromDate) fromDate.addEventListener("change", function() { PAGE = 1; runSearch(); });
      if (toDate) toDate.addEventListener("change", function() { PAGE = 1; runSearch(); });
      if (groupToggle) groupToggle.addEventListener("change", function() { PAGE = 1; runSearch(); });

      if (quick7) quick7.addEventListener("click", function() { ensureData(); setQuickRange(7); PAGE=1; runSearch(); });
      if (quick30) quick30.addEventListener("click", function() { ensureData(); setQuickRange(30); PAGE=1; runSearch(); });
      if (quick90) quick90.addEventListener("click", function() { ensureData(); setQuickRange(90); PAGE=1; runSearch(); });
      if (quickAll) quickAll.addEventListener("click", function() { ensureData(); setQuickRange(null); PAGE=1; runSearch(); });
    })();
  </script>
</body>
</html>
